module Test_Logger_mod
   use ASTG_Logger_mod
   use pfunit_mod
   implicit none

   public :: Test_Logger

@TestCase
   type, extends(TestCase) :: Test_Logger
      type (Logger) :: logfile
   contains
      procedure :: setUp     ! overides generic
      procedure :: tearDown  ! overrides generic
   end type Test_Logger

contains

   subroutine setUp(this)
      class (Test_Logger), intent(inout) :: this
      this%logfile = newLogger('logfile')
   end subroutine setUp

   subroutine tearDown(this)
     class (Test_Logger), intent(inout) :: this
     integer :: unit

     open(newunit=unit, file='logfile')
     ! delete file
     close(unit, status='delete')

   end subroutine tearDown

 @Test
   subroutine test_log(this)
      class (Test_Logger), intent(inout) :: this

      integer :: unit
      character(len=:), allocatable :: message
      character(len=32) :: foundMessage

      message = 'hello'

      call this%logfile%log(message)
      call this%logfile%handler%close()

      open(newunit=unit, file='logfile', status='old')
      read(unit, '(a)') foundMessage
      close(unit)

      @assertEqual(message, foundMessage)
      
   end subroutine test_log
    
end module Test_Logger_mod

