module Test_FileHandler_mod
   use ASTG_FileHandler_mod
   use ASTG_AbstractHandler_mod
   use pfunit_mod
   implicit none

@TestCase
   type, extends(TestCase) :: Test_FileHandler
      type (FileHandler) :: handler
   contains
      procedure :: setUp   
      procedure :: tearDown 
   end type Test_FileHandler

contains

   subroutine setUp(this)
      class (Test_FileHandler), intent(inout) :: this
      this%handler = FileHandler('logFile')
   end subroutine setUp

   subroutine tearDown(this)
      class (Test_FileHandler), intent(inout) :: this

      integer :: unit

      call this%handler%close()

      ! delete file
      open(newunit=unit, file='logfile', status='old')
      close(unit, status='delete')


   end subroutine tearDown

@Test
   subroutine test_emit(this)
      class (Test_FileHandler), intent(inout) :: this   

      integer :: unit
      character(len=:), allocatable :: message
      character(len=32) :: foundMessage

      message = 'hello'
      call this%handler%emit(message)

      unit = this%handler%getUnit()
      rewind(unit)
      read(unit, '(a)') foundMessage

      @assertEqual(message, foundMessage)

   end subroutine test_emit
   
 @test
   subroutine test_setLevel(this)
      class (Test_FileHandler), intent(inout) :: this

      call this%handler%setLevel(DEBUG_LOGGING_LEVEL)      
      @assertEqual(1, this%handler%getLevel())

   end subroutine test_setLevel


end module Test_FileHandler_mod

